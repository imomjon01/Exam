<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Manage Statuses</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .error {
      color: red;
      margin-bottom: 15px;
    }
  </style>
  <script>
    function validatePositions() {
      const inputs = document.querySelectorAll('.position-input');
      const seen = new Set();

      for (let input of inputs) {
        const val = input.value.trim();
        if (val === '') {
          alert("Position numbers cannot be empty!");
          return false;
        }
        if (seen.has(val)) {
          alert("Position numbers must be unique. Duplicate found: " + val);
          return false;
        }
        seen.add(val);
      }
      return true;
    }
  </script>
</head>
<body>
<h2>Manage Status List</h2>

<div th:if="${error}" class="error">
  <p th:text="${error}"></p>
</div>

<form th:action="@{/manageOrders/update}" th:object="${wrapper}" method="post"
      onsubmit="return validatePositions();">

  <table>
    <thead>
    <tr>
      <th>Status Name</th>
      <th>Position Number</th>
      <th>Active</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="status, iterStat : *{statusList}">
      <!-- Status Name -->
      <td>
        <span th:text="${status.name}"></span>
        <input type="hidden" th:field="*{statusList[__${iterStat.index}__].name}" />
      </td>

      <!-- Position Number -->
      <td>
        <input type="number"
               th:field="*{statusList[__${iterStat.index}__].positionNumber}"
               class="position-input"
               required
               min="1" />
      </td>

      <!-- Active Checkbox - To'g'ri ishlaydigan versiya -->
      <td>
        <input type="checkbox"
               th:field="*{statusList[__${iterStat.index}__].active}"
               th:value="true" />
        <input type="hidden" th:name="*{'statusList[__${iterStat.index}__].active'}"
               th:value="false" />
      </td>

      <!-- ID (yashirin) -->
      <input type="hidden" th:field="*{statusList[__${iterStat.index}__].id}" />
    </tr>
    </tbody>
  </table>

  <button type="submit" class="btn btn-primary">Update Statuses</button>
  <a th:href="@{/task}" class="btn btn-secondary">Cancel</a>
</form>
</body>
</html>